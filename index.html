<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conflict Auditor</title>
    <style>
        :root {
            --primary-color: #4A5568; /* Dark Slate */
            --accent-color: #F59E0B; /* Amber */
            --accent-hover: #D97706;
            --background-color: #EDF2F7;
            --container-bg: #FFFFFF;
            --text-color: #1A202C;
            --light-text: #718096;
            --border-color: #E2E8F0;
            --success-color: #38A169;
            --error-color: #E53E3E;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
        }

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        * { box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--container-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 40px;
            border-top: 5px solid var(--primary-color);
        }

        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { font-size: 2.5em; color: var(--text-color); font-weight: 700; margin: 0; }
        .header p { font-size: 1.1em; color: var(--light-text); margin-top: 8px; }

        .upload-area { display: grid; grid-template-columns: 1fr; gap: 25px; margin-bottom: 25px; }
        @media (min-width: 768px) { .upload-area { grid-template-columns: 1fr 1fr; } }

        .file-upload-wrapper { border: 2px dashed var(--border-color); border-radius: 12px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s ease; position: relative; background-color: #FAFBFC; }
        .file-upload-wrapper.file-selected { border-color: var(--success-color); background-color: #F0FFF4; }
        .file-upload-wrapper input[type="file"] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .upload-icon { color: var(--light-text); margin-bottom: 15px; transition: all 0.3s ease; }
        .file-upload-wrapper.file-selected .upload-icon { color: var(--success-color); transform: scale(1.1); }
        .upload-text { font-weight: 500; color: var(--primary-color); }
        .upload-status { margin-top: 10px; font-size: 0.9em; color: var(--light-text); font-weight: 500; min-height: 1.2em; }

        button#analyze-button { width: 100%; padding: 15px; background-image: linear-gradient(to right, var(--accent-color), var(--accent-hover)); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
        button#analyze-button:hover { transform: translateY(-3px); box-shadow: 0 7px 20px rgba(245, 158, 11, 0.4); }
        button:disabled { background-image: none; background-color: #CBD5E0; cursor: not-allowed; transform: none; box-shadow: none; }

        #dashboard { margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 30px; }
        .spinner-wrapper { text-align: center; padding: 40px; }
        .spinner { border: 5px solid #E2E8F0; border-top: 5px solid var(--accent-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .results-header { text-align: center; font-size: 1.8em; font-weight: 600; margin-bottom: 30px; }
        #conflicts-container { display: grid; gap: 25px; }
        
        .conflict-card, .no-conflict-card { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .no-conflict-card { text-align: center; padding: 40px; background-color: #F0FFF4; border: 1px solid #C6F6D5; border-radius: 12px; }
        .no-conflict-card h2 { color: var(--success-color); }

        .conflict-card { background-color: #FFF5F5; border: 1px solid #FED7D7; border-left: 5px solid var(--error-color); border-radius: 8px; padding: 25px; }
        .conflict-card h3 { margin: 0 0 20px 0; color: var(--error-color); font-size: 1.25em; line-height: 1.4; }
        .snippets-wrapper { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 768px) { .snippets-wrapper { grid-template-columns: 1fr 1fr; } }
        .snippet { background-color: var(--container-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; }
        .snippet-header { font-weight: 600; margin-bottom: 10px; color: var(--text-color); }
        .snippet-header span { font-weight: 400; color: var(--light-text); font-size: 0.9em; }
        .snippet p { margin: 0; line-height: 1.6; word-wrap: break-word; font-size: 0.95em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Conflict Auditor</h1>
        <p>Your intelligent agent for detecting contradictions across documents.</p>
    </div>

    <div class="upload-area">
        <label for="file-upload-1" class="file-upload-wrapper" id="upload-wrapper-1">
            <div class="upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
            </div>
            <p class="upload-text">Upload Document A</p>
            <input type="file" id="file-upload-1" accept=".pdf">
            <div class="upload-status" id="upload-status-1"></div>
        </label>

        <label for="file-upload-2" class="file-upload-wrapper" id="upload-wrapper-2">
            <div class="upload-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
            </div>
            <p class="upload-text">Upload Document B</p>
            <input type="file" id="file-upload-2" accept=".pdf">
            <div class="upload-status" id="upload-status-2"></div>
        </label>
    </div>
    
    <button id="analyze-button" disabled>Find Conflicts</button>

    <div id="dashboard">
        <div id="spinner-container" style="display: none;">
            <div class="spinner-wrapper">
                <div class="spinner"></div>
                <p style="color: var(--light-text); font-weight: 500;">Scanning documents for inconsistencies...</p>
            </div>
        </div>
        <div id="conflicts-container"></div>
    </div>
</div>

<script>
    const API_BASE_URL = 'http://127.0.0.1:8000';
    
    const fileUpload1 = document.getElementById('file-upload-1');
    const fileUpload2 = document.getElementById('file-upload-2');
    const uploadWrapper1 = document.getElementById('upload-wrapper-1');
    const uploadWrapper2 = document.getElementById('upload-wrapper-2');
    const uploadStatus1 = document.getElementById('upload-status-1');
    const uploadStatus2 = document.getElementById('upload-status-2');
    const analyzeButton = document.getElementById('analyze-button');
    const spinnerContainer = document.getElementById('spinner-container');
    const conflictsContainer = document.getElementById('conflicts-container');
    
    let file1 = null;
    let file2 = null;

    fileUpload1.addEventListener('change', (event) => {
        file1 = event.target.files[0];
        updateFileStatus(file1, uploadStatus1, uploadWrapper1);
        checkFilesAndEnableButton();
    });

    fileUpload2.addEventListener('change', (event) => {
        file2 = event.target.files[0];
        updateFileStatus(file2, uploadStatus2, uploadWrapper2);
        checkFilesAndEnableButton();
    });
    
    function updateFileStatus(file, statusEl, wrapperEl) {
        if (file) {
            statusEl.textContent = file.name;
            wrapperEl.classList.add('file-selected');
        } else {
            statusEl.textContent = '';
            wrapperEl.classList.remove('file-selected');
        }
    }

    function checkFilesAndEnableButton() {
        analyzeButton.disabled = !(file1 && file2);
    }

    analyzeButton.addEventListener('click', async () => {
        if (!file1 || !file2) {
            alert('Please select two documents to compare.');
            return;
        }
        spinnerContainer.style.display = 'block';
        conflictsContainer.innerHTML = '';
        analyzeButton.disabled = true;
        analyzeButton.textContent = 'Analyzing...';
        
        const formData = new FormData();
        formData.append('files', file1);
        formData.append('files', file2);

        try {
            const response = await fetch(`${API_BASE_URL}/analyze/`, { method: 'POST', body: formData });
            if (!response.ok) {
                const errorResult = await response.json();
                throw new Error(errorResult.message || `HTTP error! status: ${response.status}`);
            }
            const result = await response.json();
            displayConflicts(result.conflicts);
        } catch (error) {
            console.error('Error analyzing documents:', error);
            conflictsContainer.innerHTML = `<div class="no-conflict-card" style="background-color: #FFF5F5; border-color: #FED7D7;"><h2 style="color: var(--error-color);">Analysis Failed</h2><p>${error.message}</p></div>`;
        } finally {
            spinnerContainer.style.display = 'none';
            analyzeButton.disabled = false;
            analyzeButton.textContent = 'Find Conflicts';
        }
    });

    function displayConflicts(conflicts) {
        if (conflicts.length === 0) {
            conflictsContainer.innerHTML = `<div class="no-conflict-card">
                <h2 class="results-header">âœ… All Clear!</h2>
                <p>No direct contradictions were found between the two documents.</p>
            </div>`;
            return;
        }

        let html = `<h2 class="results-header">ðŸš¨ ${conflicts.length} Potential Contradiction(s) Found</h2>`;
        conflictsContainer.innerHTML = html;
        
        conflicts.forEach((conflict, index) => {
            setTimeout(() => {
                const card = document.createElement('div');
                card.className = 'conflict-card';
                card.innerHTML = `
                    <h3>${escapeHtml(conflict.explanation)}</h3>
                    <div class="snippets-wrapper">
                        <div class="snippet">
                            <div class="snippet-header">From <span>${escapeHtml(conflict.doc1_source)}</span></div>
                            <p>"...${escapeHtml(conflict.doc1_content)}..."</p>
                        </div>
                        <div class="snippet">
                            <div class="snippet-header">From <span>${escapeHtml(conflict.doc2_source)}</span></div>
                            <p>"...${escapeHtml(conflict.doc2_content)}..."</p>
                        </div>
                    </div>
                `;
                conflictsContainer.appendChild(card);
            }, index * 150); // Staggered animation
        });
    }

    function escapeHtml(unsafe) {
        if (typeof unsafe !== 'string') return '';
        return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }
</script>

</body>
</html>